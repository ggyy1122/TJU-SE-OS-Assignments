<Window x:Class="FileSystem.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:FileSystem.ViewModels"
        xmlns:utils="clr-namespace:FileSystem.Utils"
        Title="文件系统模拟器" Height="600" Width="900">
    <Window.Resources>
        <utils:BindingProxy x:Key="Proxy" Data="{Binding}"/>
        <vm:TypeToIconConverter x:Key="TypeToIconConverter"/>
    </Window.Resources>
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240"/>
            <ColumnDefinition Width="10"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧目录树 -->
        <GroupBox Header="目录结构" Grid.Column="0">
            <TreeView ItemsSource="{Binding RootNodes}" SelectedItemChanged="TreeView_SelectedItemChanged">
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="📁" FontSize="14"/>
                            <TextBlock Text="{Binding Name}" Margin="5,0"/>
                        </StackPanel>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>
        </GroupBox>

        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch"/>

        <!-- 右侧区域 -->
        <Grid Grid.Column="2" Margin="10,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- 顶部操作栏 -->
                <RowDefinition Height="Auto"/>
                <!-- 创建区域 -->
                <RowDefinition Height="*"/>
                <!-- 文件列表区域 -->
            </Grid.RowDefinitions>

            <!-- 顶部操作栏 -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,10" Grid.Row="0">
                <Button Content="上一级" Command="{Binding UpDirCommand}" Width="60"/>
                <TextBlock Text="当前目录：" FontWeight="Bold" Margin="10,0"/>
                <TextBlock Text="{Binding CurrentPath}" Margin="5,0"/>
            </StackPanel>

            <!-- 创建区域 -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,10" Grid.Row="1">
                <TextBox Width="120" Text="{Binding NewDirName, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,5,0"/>
                <Button Content="新建目录" Command="{Binding CreateDirCommand}" Margin="0,0,10,0"/>
                <TextBox Width="120" Text="{Binding NewFileName, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,5,0"/>
                <Button Content="新建文件" Command="{Binding CreateFileCommand}"/>
            </StackPanel>

            <!-- 文件列表区域 -->
            <GroupBox Header="文件列表" Margin="0,0,0,0" Grid.Row="2">
                <Grid Background="Transparent">
                    <Grid.ContextMenu>
                        <ContextMenu DataContext="{Binding Source={StaticResource Proxy}, Path=Data}">
                            <MenuItem Header="新建文件夹" Command="{Binding CreateDirCommand}" />
                            <MenuItem Header="新建文件" Command="{Binding CreateFileCommand}" />
                            <Separator/>
                            <MenuItem Header="重命名"
                                      Command="{Binding RenameCommand}"
                                      CommandParameter="{Binding SelectedEntry}"/>
                            <MenuItem Header="删除"
                                      Command="{Binding DeleteCommand}"
                                      CommandParameter="{Binding SelectedEntry}"/>
                        </ContextMenu>
                    </Grid.ContextMenu>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <ListView ItemsSource="{Binding CurrentEntries}"
                              SelectedItem="{Binding SelectedEntry, Mode=TwoWay}"
                              MouseDoubleClick="ListView_MouseDoubleClick"
                              Grid.Row="0"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="名称" Width="160">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Type, Converter={StaticResource TypeToIconConverter}}" FontSize="14"/>
                                                <TextBlock Text="{Binding Name}" Margin="5,0"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="类型" Width="80" DisplayMemberBinding="{Binding Type}"/>
                                <GridViewColumn Header="修改时间" Width="160" DisplayMemberBinding="{Binding ModifiedTime, StringFormat={}{0:yyyy-MM-dd HH:mm:ss}}"/>
                                <GridViewColumn Header="大小(字节)" Width="80" DisplayMemberBinding="{Binding Size}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>
            </GroupBox>
        </Grid>
    </Grid>
</Window>
